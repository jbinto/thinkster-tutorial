"use strict";var app=angular.module("angNewsApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase"]);app.config(["$routeProvider",function(a){a.when("/posts/",{templateUrl:"views/posts.html",controller:"PostsCtrl"}).when("/posts/:postId",{templateUrl:"views/showpost.html",controller:"PostViewCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"AuthCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"AuthCtrl"}).when("/",{redirectTo:"/posts"}).otherwise({template:"<h1>404</h1>"})}]),app.constant("FIREBASE_URL","https://vivid-fire-1631.firebaseio.com/"),app.controller("PostsCtrl",["$scope","$location","Post",function(a,b,c){a.posts=c.all,a.post={url:"http://",title:""},a.deletePost=function(a){c.delete(a)}}]),app.controller("NavCtrl",["$scope","$location","Post","Auth",function(a,b,c,d){a.post={url:"http://",title:""},a.submitPost=function(){c.create(a.post).then(function(c){a.post={url:"http://",title:""},b.path("/posts/"+c)})},a.logout=function(){d.logout()}}]),app.factory("Post",["$firebase","FIREBASE_URL","User",function(a,b,c){var d=new Firebase(b+"posts"),e=a(d),f={all:e,create:function(a){if(c.signedIn()){var b=c.getCurrent();return a.owner=b.username,e.$add(a).then(function(a){var c=a.name(),d=b.$child("posts");return d.$child(c).$set(c),c})}},find:function(a){return e.$child(a)},"delete":function(a){if(c.signedIn()){var b=f.find(a);b.$on("loaded",function(){var d=c.findByUsername(b.owner);e.$remove(a).then(function(){d.$child("posts").$remove(a)})})}return e.$remove(a)}};return f}]),app.controller("PostViewCtrl",["$scope","$routeParams","Post",function(a,b,c){a.post=c.find(b.postId)}]),app.filter("hostnameFromUrl",function(){return function(a){var b=document.createElement("a");return b.href=a,b.hostname}}),app.factory("Auth",["$firebaseSimpleLogin","FIREBASE_URL","$rootScope",function(a,b,c){var d=new Firebase(b),e=a(d),f={register:function(a){return e.$createUser(a.email,a.password)},signedIn:function(){var a=null!==e.user;return console.log("signed in? "+a),a},login:function(a){return e.$login("password",a)},logout:function(){e.$logout()}};return c.signedIn=function(){return f.signedIn()},f}]),app.controller("AuthCtrl",["$scope","$location","Auth","User",function(a,b,c,d){c.signedIn()&&b.path("/"),a.$on("$firebaseSimpleLogin:login",function(){b.path("/")}),a.login=function(){c.login(a.user).then(function(){b.path("/")},function(b){a.error=b.toString()})},a.register=function(){c.register(a.user).then(function(c){console.log(c),d.create(c,a.user.username),a.login(),b.path("/")},function(b){a.error=b.toString()})}}]),app.service("User",["$firebase","FIREBASE_URL","$rootScope",function(a,b,c){function d(a){console.log("looking for user "+a);var b=g.findByUsername(a);console.log(b),c.currentUser=b}var e=new Firebase(b+"users"),f=a(e),g={create:function(a,b){f[b]={md5Hash:a.md5_hash,username:b,$priority:a.uid},f.$save(b).then(function(){d(b)})},findByUsername:function(a){return a?f.$child(a):void 0},signedIn:function(){return void 0!==c.currentUser},getCurrent:function(){return c.currentUser}};return c.$on("$firebaseSimpleLogin:login",function(b,c){console.log("welcome! you gave me:"),console.log(c);var f=a(e.startAt(c.uid).endAt(c.uid));console.log("executed query!"),f.$on("loaded",function(){var a=f.$getIndex()[0];console.log("query returned: "+a),d(a)})}),c.$on("$firebaseSimpleLogin:logout",function(a,b){console.log("bye!"),console.log(b),delete c.currentUser}),g}]);